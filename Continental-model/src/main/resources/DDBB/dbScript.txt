-- public.clients definition

-- Drop table

-- DROP TABLE public.clients;

CREATE TABLE public.clients (
	client_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"document" varchar(20) NOT NULL,
	"name" varchar(100) NOT NULL,
	country_code varchar(2) NOT NULL,
	client_down_date date NULL,
	CONSTRAINT clients_pkey PRIMARY KEY (client_id)
);


-- public.criteria definition

-- Drop table

-- DROP TABLE public.criteria;

CREATE TABLE public.criteria (
	criteria_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" varchar(255) NOT NULL,
	description text NULL,
	multiplier numeric NULL,
	"type" varchar(255) NULL,
	date_condition text NULL,
	CONSTRAINT criteria_pkey PRIMARY KEY (criteria_id)
);


-- public.hotels definition

-- Drop table

-- DROP TABLE public.hotels;

CREATE TABLE public.hotels (
	hotel_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" varchar(255) NOT NULL,
	address varchar(255) NOT NULL,
	hotel_down_date date NULL,
	CONSTRAINT hoteles_pkey PRIMARY KEY (hotel_id)
);


-- public.products definition

-- Drop table

-- DROP TABLE public.products;

CREATE TABLE public.products (
	product_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" varchar(255) NULL,
	price float8 NULL,
	CONSTRAINT products_pkey PRIMARY KEY (product_id)
);


-- public.roomtype definition

-- Drop table

-- DROP TABLE public.roomtype;

CREATE TABLE public.roomtype (
	type_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"type" varchar NULL,
	price float8 NULL,
	CONSTRAINT roomtype_pkey PRIMARY KEY (type_id)
);


-- public.trole definition

-- Drop table

-- DROP TABLE public.trole;

CREATE TABLE public.trole (
	role_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	role_name varchar(255) NULL,
	xmlclientpermission varchar(10485760) NULL,
	CONSTRAINT trole_pkey PRIMARY KEY (role_id)
);


-- public.tserver_permission definition

-- Drop table

-- DROP TABLE public.tserver_permission;

CREATE TABLE public.tserver_permission (
	id_server_permission int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	permission_name varchar(10485760) NULL,
	CONSTRAINT tserver_permission_pkey PRIMARY KEY (id_server_permission)
);


-- public.tuser definition

-- Drop table

-- DROP TABLE public.tuser;

CREATE TABLE public.tuser (
	user_ varchar(50) NOT NULL,
	"password" varchar(50) NULL,
	"name" varchar(50) NULL,
	surname varchar(50) NULL,
	email varchar(50) NULL,
	nif varchar(50) NULL,
	lastpasswordupdate timestamp NULL DEFAULT CURRENT_TIMESTAMP,
	firstlogin bool NULL DEFAULT true,
	user_down_date varchar NULL,
	CONSTRAINT tuser_pkey PRIMARY KEY (user_)
);


-- public.accesscards definition

-- Drop table

-- DROP TABLE public.accesscards;

CREATE TABLE public.accesscards (
	access_card_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	hotel_id int4 NULL,
	available bool NULL DEFAULT true,
	card_down_date date NULL,
	CONSTRAINT accesscards_pkey PRIMARY KEY (access_card_id),
	CONSTRAINT fk_accesscards_hotels FOREIGN KEY (hotel_id) REFERENCES public.hotels(hotel_id)
);


-- public.employees definition

-- Drop table

-- DROP TABLE public.employees;

CREATE TABLE public.employees (
	employee_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"document" varchar(255) NULL,
	"name" varchar(255) NULL,
	hotel_id int4 NULL,
	employee_down_date date NULL,
	CONSTRAINT employees_pkey PRIMARY KEY (employee_id),
	CONSTRAINT employees_hotelid_fkey FOREIGN KEY (hotel_id) REFERENCES public.hotels(hotel_id)
);


-- public.parkings definition

-- Drop table

-- DROP TABLE public.parkings;

CREATE TABLE public.parkings (
	parking_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	hotel_id int4 NULL,
	total_capacity int4 NULL,
	occupied_capacity int4 NULL,
	description text NULL,
	price numeric(10, 2) NULL,
	CONSTRAINT parkings_pkey PRIMARY KEY (parking_id),
	CONSTRAINT parkings_id_hotel_fkey FOREIGN KEY (hotel_id) REFERENCES public.hotels(hotel_id)
);


-- public.rooms definition

-- Drop table

-- DROP TABLE public.rooms;

CREATE TABLE public.rooms (
	room_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	hotel_id int4 NOT NULL,
	roomnumber int4 NOT NULL,
	roomdowndate date NULL,
	room_type_id int4 NULL,
	CONSTRAINT habitaciones_pkey PRIMARY KEY (room_id),
	CONSTRAINT habitaciones_idhotel_fkey FOREIGN KEY (hotel_id) REFERENCES public.hotels(hotel_id),
	CONSTRAINT rooms_fk FOREIGN KEY (type_id) REFERENCES public.roomtype(type_id)
);


-- public.seasons definition

-- Drop table

-- DROP TABLE public.seasons;

CREATE TABLE public.seasons (
	season_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	criteria_id int4 NOT NULL,
	start_day int4 NOT NULL,
	start_month int4 NOT NULL,
	end_day int4 NOT NULL,
	end_month int4 NOT NULL,
	CONSTRAINT seasons_pkey PRIMARY KEY (season_id),
	CONSTRAINT seasons_criteria_id_fkey FOREIGN KEY (criteria_id) REFERENCES public.criteria(id)
);


-- public.trole_server_permission definition

-- Drop table

-- DROP TABLE public.trole_server_permission;

CREATE TABLE public.trole_server_permission (
	id_role_server_permission int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	role_id int4 NULL,
	id_server_permission int4 NULL,
	CONSTRAINT trole_server_permission_pkey PRIMARY KEY (id_role_server_permission),
	CONSTRAINT fk_trole_server_permission FOREIGN KEY (role_id) REFERENCES public.trole(role_id) ON DELETE CASCADE,
	CONSTRAINT fk_tserver_permission FOREIGN KEY (id_server_permission) REFERENCES public.tserver_permission(id_server_permission)
);


-- public.tuser_role definition

-- Drop table

-- DROP TABLE public.tuser_role;

CREATE TABLE public.tuser_role (
	user_role_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	role_id int4 NULL,
	user_ varchar(50) NULL,
	CONSTRAINT tuser_role_pkey PRIMARY KEY (user_role_id),
	CONSTRAINT fk_trole FOREIGN KEY (role_id) REFERENCES public.trole(role_id) ON DELETE CASCADE,
	CONSTRAINT fk_tuser FOREIGN KEY (user_) REFERENCES public.tuser(user_)
);


-- public.bookings definition

-- Drop table

-- DROP TABLE public.bookings;

CREATE TABLE public.bookings (
	booking_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	room_id int4 NOT NULL,
	initial_date date NOT NULL,
	end_date date NOT NULL,
	client_id int4 NOT NULL,
	checkin_datetime timestamp NULL,
	checkout_datetime timestamp NULL,
	price numeric NULL,
	CONSTRAINT reservas_pkey PRIMARY KEY (booking_id),
	CONSTRAINT bookings_clientid_fkey FOREIGN KEY (client_id) REFERENCES public.clients(client_id),
	CONSTRAINT reservas_idhabitacion_fkey FOREIGN KEY (room_id) REFERENCES public.rooms(room_id) ON DELETE CASCADE ON UPDATE CASCADE
);


-- public.extraexpenses definition

-- Drop table

-- DROP TABLE public.extraexpenses;

CREATE TABLE public.extraexpenses (
	extra_expense_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	booking_id int4 NULL,
	concept varchar NULL,
	price float8 NULL,
	CONSTRAINT extraexpenses_pkey PRIMARY KEY (extra_expense_id),
	CONSTRAINT extraexpenses_fk FOREIGN KEY (booking_id) REFERENCES public.bookings(booking_id)
);


-- public.parkinghistory definition

-- Drop table

-- DROP TABLE public.parkinghistory;

CREATE TABLE public.parkinghistory (
	parking_history_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	parking_id int4 NULL,
	booking_id int4 NULL,
	entry_date date NULL,
	exit_date date NULL,
	CONSTRAINT parkinghistory_pkey PRIMARY KEY (parking_history_id),
	CONSTRAINT parkinghistory_id_booking_fkey FOREIGN KEY (booking_id) REFERENCES public.bookings(booking_id),
	CONSTRAINT parkinghistory_id_parking_fkey FOREIGN KEY (parking_id) REFERENCES public.parkings(parking_id)
);


-- public.refrigerators definition

-- Drop table

-- DROP TABLE public.refrigerators;

CREATE TABLE public.refrigerators (
	fridge_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	room_id int4 NULL,
	capacity int4 NULL,
	CONSTRAINT refrigerators_pkey PRIMARY KEY (fridge_id),
	CONSTRAINT refrigerators_room_id_fkey FOREIGN KEY (room_id) REFERENCES public.rooms(roomid)
);


-- public.accesscard_booking definition

-- Drop table

-- DROP TABLE public.accesscard_booking;

CREATE TABLE public.accesscard_booking (
	access_card_assignment_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	access_card_id int4 NULL,
	booking_id int4 NULL,
	CONSTRAINT accesscard_booking_pkey PRIMARY KEY (access_card_assignment_id),
	CONSTRAINT accesscard_booking_accesscardid_fkey FOREIGN KEY (access_card_id) REFERENCES public.accesscards(access_card_id),
	CONSTRAINT accesscard_booking_bookingid_fkey FOREIGN KEY (booking_id) REFERENCES public.bookings(booking_id)
);


-- public.refrigerator_stock definition

-- Drop table

-- DROP TABLE public.refrigerator_stock;

CREATE TABLE public.refrigerator_stock (
	stock_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	fridge_id int4 NULL,
	product_id int4 NULL,
	stock int4 NULL,
	CONSTRAINT refrigerator_stock_pkey PRIMARY KEY (stock_id),
	CONSTRAINT refrigerator_stock_fk FOREIGN KEY (fridge_id) REFERENCES public.refrigerators(fridge_id),
	CONSTRAINT refrigerator_stock_fk_1 FOREIGN KEY (product_id) REFERENCES public.products(product_id)
);